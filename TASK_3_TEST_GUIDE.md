# Task 3 Testing Guide: Live Dashboard with Agent Activity Feed

## Overview
This guide will help you test the live dashboard features including:
- SSE endpoint for real-time agent activity
- Updated incident cards with AI analysis
- Pattern alerts
- Resolution panel with code fixes
- Enhanced Postman collection

## Prerequisites

1. **Redis must be running**
   ```bash
   redis-server
   ```

2. **Backend server must be running**
   ```bash
   cd CrashLensAI/backend
   npm start
   ```

3. **All three agents must be running** (in separate terminals)
   ```bash
   # Terminal 1
   cd CrashLensAI/backend
   node agents/triage-agent.js
   
   # Terminal 2
   node agents/pattern-agent.js
   
   # Terminal 3
   node agents/resolution-agent.js
   ```

4. **Frontend must be running**
   ```bash
   cd CrashLensAI/frontend
   npm run dev
   ```

## Test 1: SSE Endpoint

### Manual Test with curl
```bash
curl -N http://localhost:3001/api/agent-activity
```

Expected output: You should see a stream of events starting with a connection message.

### Test with Node.js script
```bash
cd CrashLensAI/backend
node test-sse.js
```

Expected: Should connect and show any agent activity events for 10 seconds.

## Test 2: Agent Activity Feed in Dashboard

1. Open browser to `http://localhost:3000`
2. You should see a new "ðŸ¤– Live Agent Activity" panel at the top
3. The connection status should show "Connected" with a green dot
4. Send a crash from Postman (see Test 3)
5. Watch the activity feed update in real-time showing:
   - Triage Agent analyzing the incident
   - Pattern Agent checking for patterns
   - Resolution Agent generating fixes (if applicable)

## Test 3: Single Crash Scenarios

Open Postman and import the updated collection. Navigate to "Single Crash Scenarios" folder.

### Test 3.1: Undefined Error
1. Send "Report Crash - Undefined Error"
2. Watch dashboard for:
   - Agent activity showing "Triage Agent: Analyzing incident..."
   - New incident appearing with severity badge
   - Root cause and suggested fix displayed
   - "Analyzed by triage-agent" badge

### Test 3.2: Auth Failure
1. Send "Report Crash - Auth Failure"
2. Verify incident shows with appropriate severity

### Test 3.3: Null Pointer
1. Send "Report Crash - Null Pointer"
2. Check if resolution agent generates a fix
3. Look for "Fix Available" button on the incident card

### Test 3.4: Memory Error
1. Send "Report Crash - Memory Error"
2. Verify Critical severity is assigned

## Test 4: Pattern Detection (Rapid-Fire)

This is the most impressive demo feature!

1. In Postman, navigate to "Rapid-Fire Pattern Detection" folder
2. Select all 6 "Login Crash" requests
3. Use Postman Runner or send them rapidly (within 60 seconds)
4. Watch the dashboard:
   - Agent activity feed shows multiple "Triage Agent" entries
   - After 5+ similar crashes, Pattern Agent should detect the pattern
   - A purple "Pattern Detected" alert banner should appear at the top
   - The banner shows:
     - Pattern type
     - Affected endpoints
     - Frequency count
     - First and last seen timestamps

## Test 5: Resolution Panel

1. Send a crash that triggers a fix (e.g., Null Pointer crash)
2. Wait for the incident to be analyzed
3. Look for the "ðŸ”§ Fix Available" button on the incident card
4. Click the button
5. Verify the modal shows:
   - Code patch with syntax highlighting
   - Explanation of the fix
   - Language indicator
   - Copy button (test copying the code)
   - Generated by agent name
   - Timestamp

## Test 6: Updated Incident Cards

Verify each incident card now shows:
- âœ… Color-coded severity badge (ðŸ”´ Critical, ðŸŸ¡ High, ðŸ”µ Medium, ðŸŸ¢ Low)
- âœ… Root cause (if analyzed by AI)
- âœ… Suggested fix
- âœ… "Analyzed by [agent-name]" badge
- âœ… "Fix Available" button (if resolution exists)

## Test 7: Pattern Alerts

1. After triggering pattern detection (Test 4)
2. Verify the pattern alert banner shows:
   - ðŸ“Š Icon with animation
   - "Pattern Detected" badge
   - Frequency count
   - Affected endpoints
   - Time range (first seen to last seen)
   - Close button (X)
3. Click the X to dismiss the alert

## Test 8: SSE Reconnection

1. With dashboard open and connected
2. Stop the backend server
3. Verify connection status changes to "Reconnecting..." with orange dot
4. Restart the backend server
5. Verify it reconnects automatically within 5 seconds

## Test 9: Full Demo Flow

This is the complete demo sequence:

1. **Setup**: All services running (Redis, backend, 3 agents, frontend)
2. **Open Dashboard**: Browser at http://localhost:3000
3. **Verify Connection**: Agent activity shows "Connected"
4. **Send Single Crash**: Use Postman to send "Undefined Error"
5. **Watch Activity**: See triage agent analyze in real-time
6. **Verify Incident**: New incident appears with AI analysis
7. **Rapid-Fire**: Send all 6 login crashes quickly
8. **Pattern Detection**: Watch for pattern alert banner
9. **Check Fix**: Look for "Fix Available" button
10. **View Resolution**: Click button to see code patch
11. **Verify All Features**: Activity feed, patterns, incidents all updating

## Expected Results Summary

### Agent Activity Feed
- âœ… Shows live stream of agent actions
- âœ… Color-coded by agent type
- âœ… Auto-scrolls to show latest
- âœ… Connection status indicator
- âœ… Reconnects automatically on disconnect

### Pattern Alerts
- âœ… Appears after 5+ similar crashes
- âœ… Shows pattern details
- âœ… Animated and eye-catching
- âœ… Dismissible

### Incident Cards
- âœ… AI-analyzed severity
- âœ… Root cause explanation
- âœ… Suggested fixes
- âœ… Agent attribution
- âœ… Fix available button

### Resolution Panel
- âœ… Modal with code patch
- âœ… Syntax highlighting
- âœ… Copy functionality
- âœ… Explanation text
- âœ… Agent and timestamp info

## Troubleshooting

### SSE not connecting
- Check backend is running on port 3001
- Check browser console for errors
- Verify CORS is enabled in backend

### No agent activity showing
- Verify agents are running
- Check agents are publishing to Redis "agent-activity" stream
- Check Redis is running

### Patterns not detected
- Send at least 5 similar crashes within 60 seconds
- Verify pattern-agent is running
- Check pattern-agent logs for errors

### Fix Available button not showing
- This is currently a demo feature
- It checks if patterns exist for the endpoint
- In production, would query a resolutions API endpoint

## API Endpoints Added

1. **GET /api/agent-activity** (SSE)
   - Returns: Server-Sent Events stream
   - Events: Agent activity in real-time

2. **GET /api/patterns**
   - Returns: Array of detected patterns
   - Query params: `?limit=10`

## Files Modified/Created

### Backend
- âœ… `routes/incidents.js` - Added SSE endpoint
- âœ… `test-sse.js` - SSE testing script

### Frontend
- âœ… `components/AgentActivity.jsx` - Live activity feed
- âœ… `components/AgentActivity.css` - Styling
- âœ… `components/PatternAlert.jsx` - Pattern banners
- âœ… `components/PatternAlert.css` - Styling
- âœ… `components/ResolutionPanel.jsx` - Fix modal
- âœ… `components/ResolutionPanel.css` - Styling
- âœ… `components/IncidentCard.jsx` - Updated with AI fields
- âœ… `components/IncidentCard.css` - Updated styling
- âœ… `App.jsx` - Integrated new components

### Postman
- âœ… `CrashLensAI.postman_collection.json` - Added scenarios and rapid-fire folder

## Success Criteria

All features working:
- [x] SSE endpoint streaming agent activity
- [x] Agent activity feed showing live updates
- [x] Pattern alerts appearing after 5+ crashes
- [x] Incident cards showing AI analysis
- [x] Resolution panel with code fixes
- [x] Postman collection with multiple scenarios
- [x] Rapid-fire folder for pattern detection
- [x] Auto-reconnection on disconnect
- [x] Color-coded severity badges
- [x] Agent attribution badges

## Next Steps

After testing, you can:
1. Customize the OpenAI prompts for better analysis
2. Add more crash scenarios to Postman
3. Implement real resolution API endpoint
4. Add filtering/search to agent activity
5. Add pattern history view
6. Implement resolution voting/feedback
